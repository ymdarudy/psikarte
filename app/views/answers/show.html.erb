<h1>回答結果</h1>
<small>
  回答日時:
  <%= times = current_user.answers.scoped_by_psychology_test(@psychology_test).answered_times.sort.reverse %>
</small>
<p>※直近の回答結果を下記に表示します。</p>

<h2><%= @psychology_test.title %></h2>
<h3>補足情報</h3>
<p><%= link_to @psychology_test.referrer, @psychology_test.referrer_url, target: :_blank, rel: "noopener noreferrer" %></p>
<% @psychology_test.supplementary_informations.each do |info|%>
  <p><%= link_to info.site_name, info.site_url, target: :_blank, rel: "noopener noreferrer" %></p>
<% end %>
<hr>

<% personality_points = [] %>

<% @psychology_test.personalities.each do |personality| %>
  <% points = current_user.answers.scoped_by_personality(personality).points_with_answered_times[times[0]].collect(&:point) %>
  <% if personality.scoring_system == 1 %>
    <% point = points.sum %>
  <% elsif personality.scoring_system == 2 %>
    <% point = points.sum.fdiv(points.size) %>
  <% end %>
  <h3><%= "#{personality.name} : #{point}点" %></h3>
  <p><%= personality.description %></p>
  <% personality_points << [personality.name, point] %>
<% end %>

<%= bar_chart personality_points, id: "bar-chart", width: "800px", height: "500px", max: 8, colors: ["#00b379"]  %>
